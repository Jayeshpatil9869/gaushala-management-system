(()=>{var e={};e.id=352,e.ids=[352],e.modules={2507:(e,s,t)=>{"use strict";t.d(s,{U:()=>i});var r=t(80261),a=t(44999);async function i(){let e=await (0,a.UL)();return(0,r.createServerClient)("https://enpplseddbfstmefufee.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVucHBsc2VkZGJmc3RtZWZ1ZmVlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAwNTgyMDUsImV4cCI6MjA2NTYzNDIwNX0.TxFqh1lGx91iKIOIZC-qnjT6n0s1jnBGH9R8SXMwCAE",{cookies:{getAll:()=>e.getAll(),setAll(s){try{s.forEach(({name:s,value:t,options:r})=>e.set(s,t,r))}catch{}}}})}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32389:(e,s,t)=>{"use strict";t.r(s),t.d(s,{patchFetch:()=>w,routeModule:()=>h,serverHooks:()=>x,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>f});var r={};t.r(r),t.d(r,{GET:()=>d});var a=t(96559),i=t(48088),o=t(37719),c=t(2507),u=t(32190),n=t(29021),p=t.n(n),l=t(33873),m=t.n(l);async function d(){try{let e=await (0,c.U)(),s={success:!0,messages:[]};try{await e.rpc("create_helper_functions"),s.messages.push("Created helper functions")}catch(e){s.messages.push(`Error creating helper functions: ${e.message}`)}try{await e.rpc("create_cow_table_if_not_exists"),s.messages.push("Ensured cows table exists")}catch(e){s.messages.push(`Error creating cows table: ${e.message}`)}try{await e.rpc("add_age_column_if_not_exists"),s.messages.push("Ensured age column exists")}catch(e){s.messages.push(`Error adding age column: ${e.message}`)}try{await e.rpc("create_activity_logs_table_if_not_exists"),s.messages.push("Ensured activity_logs table exists")}catch(e){s.messages.push(`Error creating activity_logs table: ${e.message}`)}try{try{let{data:t,error:r}=await e.rpc("setup_storage_rls");r?s.messages.push(`Error setting up storage RLS via RPC: ${r.message}`):s.messages.push("Storage RLS policies applied successfully")}catch(e){s.messages.push(`RPC error: ${e.message}`)}let{data:t}=await e.storage.listBuckets();if(t?.find(e=>"cow-images"===e.name))s.messages.push("cow-images bucket already exists");else{let{error:t}=await e.storage.createBucket("cow-images",{public:!0,fileSizeLimit:0xa00000});t?s.messages.push(`Error creating bucket: ${t.message}`):s.messages.push("Created cow-images bucket")}}catch(e){s.messages.push(`Storage setup error: ${e.message}`)}try{let e=m().join(process.cwd(),"public","uploads");p().existsSync(e)?s.messages.push("Filesystem fallback directory already exists"):(p().mkdirSync(e,{recursive:!0}),s.messages.push("Created filesystem fallback directory"))}catch(e){s.messages.push(`Filesystem setup error: ${e.message}`)}let t=await g(e);return s.messages.push(...t.messages),t.success?s.messages.push("At least one storage method is working"):(s.success=!1,s.messages.push("All storage methods failed")),u.NextResponse.json(s)}catch(e){return console.error("Error in database setup:",e),u.NextResponse.json({success:!1,error:`Database setup failed: ${e.message}`,messages:[`Fatal error: ${e.message}`]},{status:500})}}async function g(e){let s={success:!1,messages:[],methods:{}};try{let t=new Blob(["test content"],{type:"text/plain"}),r=`test-direct-${Date.now()}.txt`,{data:a,error:i}=await e.storage.from("cow-images").upload(r,t,{upsert:!0});if(i)s.messages.push(`Direct upload failed: ${i.message}`),s.methods.direct=!1;else{let{data:t}=e.storage.from("cow-images").getPublicUrl(a.path);s.messages.push(`Direct upload successful: ${t.publicUrl}`),s.methods.direct=!0,await e.storage.from("cow-images").remove([a.path])}}catch(e){s.messages.push(`Direct upload error: ${e.message}`),s.methods.direct=!1}try{let t=`test-signed-${Date.now()}.txt`,{data:r,error:a}=await e.storage.from("cow-images").createSignedUploadUrl(t);if(a)s.messages.push(`Signed URL creation failed: ${a.message}`),s.methods.signed=!1;else{let t=new Blob(["test content"],{type:"text/plain"}),a=await fetch(r.signedUrl,{method:"PUT",body:t,headers:{"Content-Type":"text/plain"}});if(a.ok){let{data:t}=e.storage.from("cow-images").getPublicUrl(r.path);s.messages.push(`Signed URL upload successful: ${t.publicUrl}`),s.methods.signed=!0,await e.storage.from("cow-images").remove([r.path])}else s.messages.push(`Signed URL upload failed: ${a.statusText}`),s.methods.signed=!1}}catch(e){s.messages.push(`Signed URL error: ${e.message}`),s.methods.signed=!1}try{let e=`test-fs-${Date.now()}.txt`,t=m().join(process.cwd(),"public","uploads");p().existsSync(t)||p().mkdirSync(t,{recursive:!0}),p().writeFileSync(m().join(t,e),"test content"),p().existsSync(m().join(t,e))?(s.messages.push(`Filesystem storage successful: /uploads/${e}`),s.methods.filesystem=!0,p().unlinkSync(m().join(t,e))):(s.messages.push("Filesystem storage failed: File not created"),s.methods.filesystem=!1)}catch(e){s.messages.push(`Filesystem error: ${e.message}`),s.methods.filesystem=!1}return s.success=s.methods.direct||s.methods.signed||s.methods.filesystem,s}let h=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/setup-db/route",pathname:"/api/setup-db",filename:"route",bundlePath:"app/api/setup-db/route"},resolvedPagePath:"D:\\Work\\Gaushala Cow Managment\\Gaushala Cow Managment\\src\\app\\api\\setup-db\\route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:y,workUnitAsyncStorage:f,serverHooks:x}=h;function w(){return(0,o.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:f})}},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},51906:e=>{function s(e){var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}s.keys=()=>[],s.resolve=s,s.id=51906,e.exports=s},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[447,875,580],()=>t(32389));module.exports=r})();