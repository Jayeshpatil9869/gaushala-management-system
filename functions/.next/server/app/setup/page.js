(()=>{var e={};e.id=620,e.ids=[620],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16189:(e,t,r)=>{"use strict";var a=r(65773);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32070:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\Work\\\\Gaushala Cow Managment\\\\Gaushala Cow Managment\\\\src\\\\app\\\\setup\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Work\\Gaushala Cow Managment\\Gaushala Cow Managment\\src\\app\\setup\\page.tsx","default")},33873:e=>{"use strict";e.exports=require("path")},41862:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(62688).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},41896:(e,t,r)=>{Promise.resolve().then(r.bind(r,44392))},44392:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var a=r(60687),s=r(43210),n=r(44493),o=r(29523),i=r(41862),l=r(16189);function u(){let e=(0,l.useRouter)(),[t,r]=(0,s.useState)(!1),[u,c]=(0,s.useState)([]),[d,p]=(0,s.useState)(null),m=async()=>{r(!0),p(null),c(["Starting database setup..."]);try{let e=await fetch("/api/init-db"),t=await e.json();if(t.messages&&c(e=>[...e,...t.messages]),!t.success){p(`Database initialization failed: ${t.error||"Unknown error"}`),r(!1);return}c(e=>[...e,"Creating SQL execution function..."]);let a=await fetch("/api/execute-sql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql:`
          CREATE OR REPLACE FUNCTION execute_sql(sql_query TEXT)
          RETURNS JSONB AS $$
          DECLARE
            result JSONB;
          BEGIN
            EXECUTE sql_query;
            result := '{"success": true}'::JSONB;
            RETURN result;
          EXCEPTION WHEN OTHERS THEN
            result := jsonb_build_object(
              'success', false,
              'error', SQLERRM,
              'detail', SQLSTATE
            );
            RETURN result;
          END;
          $$ LANGUAGE plpgsql SECURITY DEFINER;
          `})}),s=await a.json();s.error?c(e=>[...e,`SQL function creation warning: ${s.error}`]):c(e=>[...e,"SQL execution function created successfully"]),c(e=>[...e,"Adding age column to cows table..."]);let n=await fetch("/api/execute-sql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql:"ALTER TABLE IF EXISTS public.cows ADD COLUMN IF NOT EXISTS age NUMERIC;"})}),o=await n.json();o.error?c(e=>[...e,`Adding age column warning: ${o.error}`]):c(e=>[...e,"Age column added successfully"]),c(e=>[...e,"Setting up storage bucket policy..."]);let i=await fetch("/api/execute-sql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql:`
          BEGIN;
          -- Make sure storage is installed
          CREATE EXTENSION IF NOT EXISTS "pg_stat_statements";
          -- Create policy for public access to cow-images bucket
          INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types)
          VALUES ('cow-images', 'cow-images', true, 5242880, '{image/jpeg,image/png,image/webp}')
          ON CONFLICT (id) DO UPDATE SET 
            public = true,
            file_size_limit = 5242880,
            allowed_mime_types = '{image/jpeg,image/png,image/webp}';
          
          -- Create policy for public access to objects
          CREATE POLICY IF NOT EXISTS "Public Access" 
          ON storage.objects FOR SELECT
          USING (bucket_id = 'cow-images');
          
          -- Create policy for authenticated users to upload
          CREATE POLICY IF NOT EXISTS "Authenticated users can upload" 
          ON storage.objects FOR INSERT
          WITH CHECK (bucket_id = 'cow-images' AND auth.role() = 'authenticated');
          
          COMMIT;
          `})}),l=await i.json();l.error?c(e=>[...e,`Bucket policy warning: ${l.error}`]):c(e=>[...e,"Storage bucket policy set up successfully"]),c(e=>[...e,"Database setup completed successfully!"]),r(!1)}catch(e){p(`Setup failed: ${e.message||"Unknown error"}`),r(!1)}};return(0,a.jsx)("div",{className:"container mx-auto py-10",children:(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{children:"Gaushala Management System Setup"})}),(0,a.jsx)(n.Wu,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{children:"This utility will set up your database and storage for the Gaushala Management System. Click the button below to initialize the system."}),(0,a.jsx)(o.$,{onClick:m,disabled:t,className:"bg-green-600 hover:bg-green-700",children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Setting up..."]}):"Initialize System"}),d&&(0,a.jsx)("div",{className:"p-4 mt-4 bg-red-50 border border-red-200 rounded-md text-red-700",children:d}),u.length>0&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Setup Progress"}),(0,a.jsx)("div",{className:"p-4 bg-gray-50 border rounded-md overflow-auto max-h-80",children:u.map((e,t)=>(0,a.jsxs)("div",{className:"text-sm mb-1",children:[t+1,". ",e]},t))})]}),!t&&u.length>0&&!d&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(o.$,{onClick:()=>e.push("/dashboard"),variant:"outline",children:"Go to Dashboard"})})]})})]})})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},76926:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return l}});let a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var a={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=n?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(a,o,i):a[o]=e[o]}return a.default=e,r&&r.set(e,a),a}(r(61120));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}let n={current:null},o="function"==typeof a.cache?a.cache:e=>e,i=console.warn;function l(e){return function(...t){i(e(...t))}}o(e=>{try{i(n.current)}finally{n.current=null}})},78344:(e,t,r)=>{Promise.resolve().then(r.bind(r,32070))},79551:e=>{"use strict";e.exports=require("url")},98856:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>d,pages:()=>c,routeModule:()=>p,tree:()=>u});var a=r(65239),s=r(48088),n=r(88170),o=r.n(n),i=r(30893),l={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);r.d(t,l);let u={children:["",{children:["setup",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,32070)),"D:\\Work\\Gaushala Cow Managment\\Gaushala Cow Managment\\src\\app\\setup\\page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,94431)),"D:\\Work\\Gaushala Cow Managment\\Gaushala Cow Managment\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,54413)),"D:\\Work\\Gaushala Cow Managment\\Gaushala Cow Managment\\src\\app\\not-found.tsx"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["D:\\Work\\Gaushala Cow Managment\\Gaushala Cow Managment\\src\\app\\setup\\page.tsx"],d={require:r,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/setup/page",pathname:"/setup",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:u}})}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[447,864,632],()=>r(98856));module.exports=a})();